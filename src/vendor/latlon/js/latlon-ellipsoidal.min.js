/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
/* Geodesy tools for an ellipsoidal earth model (c) Chris Veness 2005-2015   */
/* MIT Licence                                                               */
/* Includes methods for converting lat/lon coordinates between               */
/* different coordinate systems.                                             */
/*   - www.movable-type.co.uk/scripts/latlong-convert-coords.html            */
/* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
"use strict";function LatLon(a,b,c){return this instanceof LatLon?(void 0===c&&(c=LatLon.datum.WGS84),this.lat=Number(a),this.lon=Number(b),void(this.datum=c)):new LatLon(a,b,c)}if("undefined"!=typeof module&&module.exports)var Vector3d=require("./vector3d.js");if("undefined"!=typeof module&&module.exports)var Dms=require("./dms.js");LatLon.ellipsoid={WGS84:{a:6378137,b:6356752.31425,f:1/298.257223563},GRS80:{a:6378137,b:6356752.31414,f:1/298.257222101},Airy1830:{a:6377563.396,b:6356256.909,f:1/299.3249646},AiryModified:{a:6377340.189,b:6356034.448,f:1/299.3249646},Intl1924:{a:6378388,b:6356911.946,f:1/297},Bessel1841:{a:6377397.155,b:6356078.963,f:1/299.152815351}},LatLon.datum={WGS84:{ellipsoid:LatLon.ellipsoid.WGS84,transform:{tx:0,ty:0,tz:0,rx:0,ry:0,rz:0,s:0}},NAD83:{ellipsoid:LatLon.ellipsoid.GRS80,transform:{tx:1.004,ty:-1.91,tz:-.515,rx:.0267,ry:34e-5,rz:.011,s:-.0015}},OSGB36:{ellipsoid:LatLon.ellipsoid.Airy1830,transform:{tx:-446.448,ty:125.157,tz:-542.06,rx:-.1502,ry:-.247,rz:-.8421,s:20.4894}},ED50:{ellipsoid:LatLon.ellipsoid.Intl1924,transform:{tx:89.5,ty:93.8,tz:123.1,rx:0,ry:0,rz:.156,s:-1.2}},Irl1975:{ellipsoid:LatLon.ellipsoid.AiryModified,transform:{tx:-482.53,ty:130.596,tz:-564.557,rx:-1.042,ry:-.214,rz:-.631,s:-8.15}},TokyoJapan:{ellipsoid:LatLon.ellipsoid.Bessel1841,transform:{tx:148,ty:-507,tz:-685,rx:0,ry:0,rz:0,s:0}}},LatLon.prototype.convertDatum=function(a){var b,c=this;if(c.datum==LatLon.datum.WGS84&&(b=a.transform),a==LatLon.datum.WGS84){b={};for(var d in c.datum.transform)c.datum.transform.hasOwnProperty(d)&&(b[d]=-c.datum.transform[d])}void 0===b&&(c=this.convertDatum(LatLon.datum.WGS84),b=a.transform);var e=c.toCartesian();e=e.applyTransform(b);var f=e.toLatLonE(a);return f},LatLon.prototype.toCartesian=function(){var a=this.lat.toRadians(),b=this.lon.toRadians(),c=0,d=this.datum.ellipsoid.a,e=this.datum.ellipsoid.b,f=Math.sin(a),g=Math.cos(a),h=Math.sin(b),i=Math.cos(b),j=(d*d-e*e)/(d*d),k=d/Math.sqrt(1-j*f*f),l=(k+c)*g*i,m=(k+c)*g*h,n=((1-j)*k+c)*f,o=new Vector3d(l,m,n);return o},Vector3d.prototype.toLatLonE=function(a){var b=this.x,c=this.y,d=this.z,e=a.ellipsoid.a,f=a.ellipsoid.b,g=(e*e-f*f)/(e*e),h=(e*e-f*f)/(f*f),i=Math.sqrt(b*b+c*c),j=Math.sqrt(i*i+d*d),k=f*d/(e*i)*(1+h*f/j),l=k/Math.sqrt(1+k*k),m=l/k,n=Math.atan2(d+h*f*l*l*l,i-g*e*m*m*m),o=Math.atan2(c,b),p=Math.sin(n),q=(Math.cos(n),e*Math.sqrt(1-g*p*p),new LatLon(n.toDegrees(),o.toDegrees(),a));return q},Vector3d.prototype.applyTransform=function(a){var b=this.x,c=this.y,d=this.z,e=a.tx,f=a.ty,g=a.tz,h=(a.rx/3600).toRadians(),i=(a.ry/3600).toRadians(),j=(a.rz/3600).toRadians(),k=a.s/1e6+1,l=e+b*k-c*j+d*i,m=f+b*j+c*k-d*h,n=g-b*i+c*h+d*k,o=new Vector3d(l,m,n);return o},LatLon.prototype.toString=function(a,b){return Dms.toLat(this.lat,a,b)+", "+Dms.toLon(this.lon,a,b)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),"undefined"!=typeof module&&module.exports&&(module.exports=LatLon),"function"==typeof define&&define.amd&&define([],function(){return LatLon});